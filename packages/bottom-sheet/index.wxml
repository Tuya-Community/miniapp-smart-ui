<wxs src="../wxs/utils.wxs" module="utils" />
<wxs src="./index.wxs" module="computed" />

<smart-popup
  show="{{ show }}"
  position="bottom"
  round="{{ round }}"
  z-index="{{ zIndex }}"
  overlay="{{ overlay }}"
  custom-class="smart-bottom-sheet custom-class"
  native-disabled="{{ nativeDisabled }}"
  customStyle="{{draggable ? 'max-height: unset;min-height: unset;' : contentHeight ? 'max-height: fit-content;' : maxHeight ? 'max-height: ' + maxHeight + ';' : ''}}"
  safe-area-inset-bottom="{{false}}"
  close-on-click-overlay="{{ closeOnClickOverlay }}"
  root-portal="{{ rootPortal }}"
  bind:close="onClickOverlay"
  bind:before-enter="onBeforeEnter"
  bind:enter="onEnter"
  bind:after-enter="onAfterEnter"
  bind:before-leave="onBeforeLeave"
  bind:leave="onLeave"
  bind:after-leave="onAfterLeave"
  id="{{curInstanceId}}"
>
  <view class="smart-bottom-sheet__header">
    <view wx:if="{{ title }}">{{ title }}</view>
    <smart-icon 
      wx:if="{{ title && showClose }}" 
      name="{{ xmarkIcon }}" 
      class="smart-bottom-sheet__icon" 
      size="{{ iconSize }}" 
      color="{{ xmarkIconColor }}" 
      bind:click="onClose"
    />
    <slot name="title" />
  </view>
  <view wx:if="{{ contentHeight !== null }}" class="smart-bottom-sheet__content smart-bottom-sheet__content_height" style="{{computed.getHeight(contentHeight)}}">
    <slot />
  </view>
  <scroll-view wx:else class="smart-bottom-sheet__content" 
    catch:touchstart="{{draggable ? computed.onDragStart(curInstanceId) : null}}" 
    catch:touchmove="{{draggable ? computed.onDrag(curInstanceId) : null}}"
    catch:touchend="{{draggable ? computed.onDragEnd(curInstanceId, { maxDragHeight, minDragHeight, windowHeight, midDragHeight }) : null}}"
  >
    <view wx:if="{{draggable}}" class="smart-bottom-sheet__dragger" >
      <view class="smart-bottom-sheet__dragger_node"></view>
    </view>
    <slot />
  </scroll-view>
</smart-popup>
