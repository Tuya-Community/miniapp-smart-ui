name: Test Publish Manual

on:
  push:
    branches:
      - test/ci
  workflow_dispatch:

jobs:
  test_publish:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PROTECT_WRITE_TOKEN }}

    - name: Get Version from package.json
      id: package_version
      run: |
        VERSION=$(node -p "require('./package.json').version")
        echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT
        echo "ðŸ“¦ Current version in package.json: ${VERSION}"

    - name: Call Publish Manual Workflow
      uses: benc-uk/workflow-dispatch@v1
      with:
        workflow: publish-manual.yml
        repo: Tuya-Community/ray-smart-ui
        token: ${{ secrets.PROTECT_WRITE_TOKEN }}
        ref: test/ci
        inputs: '{"version":"${{ steps.package_version.outputs.VERSION }}"}'

