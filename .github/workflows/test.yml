name: Test Publish Manual

on:
  workflow_dispatch:

jobs:
  test_publish:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Get Version from package.json
      id: package_version
      run: |
        VERSION=$(node -p "require('./package.json').version")
        echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT
        echo "ğŸ“¦ Current version in package.json: ${VERSION}"

    - name: Call Publish Manual Workflow
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const version = '${{ steps.package_version.outputs.VERSION }}';
          const targetOwner = 'Tuya-Community';
          const targetRepo = 'ray-smart-ui';
          const targetBranch = 'test/ci';
          
          console.log(`ğŸš€ Triggering publish-manual.yml workflow with version: ${version}`);
          console.log(`ğŸ“¦ Target Repository: ${targetOwner}/${targetRepo}`);
          console.log(`ğŸ”€ Target Branch: ${targetBranch}`);
          
          if (!version || version.trim() === '') {
            throw new Error('âŒ Version is empty. Please ensure package.json contains a valid version.');
          }
          
          try {
            await github.rest.actions.createWorkflowDispatch({
              owner: targetOwner,
              repo: targetRepo,
              workflow_id: 'publish-manual.yml',
              ref: targetBranch,
              inputs: {
                version: version
              }
            });
            
            console.log('âœ… Successfully triggered publish-manual.yml workflow');
            console.log(`ğŸ“‹ Please check the workflow run in the Actions tab`);
            console.log(`ğŸ”— Workflow URL: https://github.com/${targetOwner}/${targetRepo}/actions/workflows/publish-manual.yml`);
          } catch (error) {
            console.error('âŒ Failed to trigger workflow:', error.message);
            console.error('Error details:', JSON.stringify(error, null, 2));
            throw error;
          }

